import pandas as pd
import plotly.express as px

# Read the CSV data into a Pandas DataFrame
data = """
timestamp,utilization.gpu [%],utilization.memory [%],memory.total [MiB],memory.used [MiB]
2025/01/22 10:58:47.494,0,0,15360,1
2025/01/22 10:58:49.997,0,0,15360,1
2025/01/22 11:11:02.957,100,39,15360,12343
2025/01/22 11:11:03.990,100,46,15360,12343
2025/01/22 11:11:05.034,100,38,15360,12343
2025/01/22 11:11:06.076,100,51,15360,12347
2025/01/22 11:11:07.110,72,81,15360,12347
2025/01/22 11:11:08.160,83,59,15360,12347
2025/01/22 11:11:09.209,91,53,15360,12347
2025/01/22 11:11:10.247,88,51,15360,12347
2025/01/22 11:11:11.281,99,41,15360,12347
2025/01/22 11:11:12.316,92,52,15360,12347
2025/01/22 11:11:13.351,87,51,15360,12347
2025/01/22 11:11:14.397,97,52,15360,12347
2025/01/22 11:11:15.443,89,52,15360,12347
2025/01/22 11:11:16.478,91,53,15360,12347
2025/01/22 11:11:17.514,94,55,15360,12347
2025/01/22 11:11:18.560,92,52,15360,12347
2025/01/22 11:11:19.605,91,48,15360,12347
2025/01/22 11:11:21.621,93,48,15360,12347
2025/01/22 11:11:22.923,89,64,15360,12347
2025/01/22 11:11:23.968,92,70,15360,12347
2025/01/22 11:11:24.999,92,51,15360,12347
2025/01/22 11:11:26.035,92,55,15360,12347
2025/01/22 11:11:27.082,92,54,15360,12347
2025/01/22 11:24:09.317,91,68,15360,12347
2025/01/22 11:24:10.368,91,50,15360,12347
2025/01/22 11:24:11.406,70,72,15360,12347
2025/01/22 11:24:12.450,0,0,15360,12347
2025/01/22 11:24:13.481,0,0,15360,12347
2025/01/22 11:24:14.529,0,0,15360,12337
2025/01/22 11:24:15.560,0,0,15360,1
2025/01/22 11:24:16.620,0,0,15360,1
2025/01/22 11:24:17.668,0,0,15360,1
2025/01/22 11:24:18.701,0,0,15360,1
2025/01/22 11:24:19.747,0,0,15360,1
2025/01/22 11:24:20.784,0,0,15360,1
"""


# Convert the data to a Pandas DataFrame
from io import StringIO

#df = pd.read_csv('../whisper_bench-output/gpu_metrics.csv', parse_dates=['timestamp'])
df = pd.read_csv(StringIO(data), parse_dates=['timestamp'])
df.columns = df.columns.str.strip()

# Create a plot
fig = px.line(df, x='timestamp', y=['utilization.gpu [%]', 'utilization.memory [%]'], 
              title="GPU and Memory Utilization Over Time", 
              labels={'timestamp': 'Time', 'value': 'Utilization (%)'},
              markers=True)

# Show the plot
fig.show()
